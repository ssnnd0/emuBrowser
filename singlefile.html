<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A modern web browser emulator with Chrome-like features">
    <meta name="keywords" content="browser, web browser, chrome, emulator">
    <meta name="author" content="Browser Emulator Team">
    <meta name="theme-color" content="#4285f4">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Browser Emulator">
    <meta property="og:title" content="Advanced Browser Emulator">
    <meta property="og:description" content="A modern web browser emulator with Chrome-like features">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Advanced Browser Emulator">
    <meta name="twitter:description" content="A modern web browser emulator with Chrome-like features">
    <title>broser</title>
    <link rel="icon" type="image/x-icon" href="icons/a.png">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="manifest" href="manifest.json"> <!-- Add Eruda script in the head section -->
    <script type="module" src="https://unpkg.com/x-frame-bypass"></script>
    <script src="//cdn.jsdelivr.net/npm/eruda"></script>
    <script>eruda.init();</script>
    <style>
        /* Modern CSS Reset and Variables */
        :root {
            /* Color Scheme */
            --primary-color: #4285f4;
            --primary-dark: #3367d6;
            --secondary-color: #34a853;
            --warning-color: #fbbc05;
            --error-color: #ea4335;
            --success-color: #0f9d58;
            /* Light Theme */
            --background-light: #ffffff;
            --surface-light: #f8f9fa;
            --surface-medium: #dfe0e1;
            --text-light-primary: #202124;
            --text-light-secondary: #5f6368;
            --border-light: #dadce0;
            --hover-light: #f1f3f4;
            --active-light: #e8f0fe;
            /* Dark Theme */
            --background-dark: #202124;
            --surface-dark: #292a2d;
            --text-dark-primary: #e8eaed;
            --text-dark-secondary: #9aa0a6;
            --border-dark: #3c4043;
            --hover-dark: #35363a;
            --active-dark: #3c4043;
            /* Shadows */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 4px 8px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 8px 16px rgba(0, 0, 0, 0.1);
            /* Typography */
            --font-primary: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            --font-monospace: 'SF Mono', Monaco, Menlo, Consolas, 'Ubuntu Mono', monospace;
            --font-size-xs: 12px;
            --font-size-sm: 14px;
            --font-size-md: 16px;
            --font-size-lg: 18px;
            --font-size-xl: 20px;
            /* Spacing */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            /* Border Radius */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-full: 9999px;
            /* Transitions */
            --transition-fast: 150ms ease;
            --transition-normal: 250ms ease;
            --transition-slow: 350ms ease;
            /* Z-index layers */
            --z-dropdown: 1000;
            --z-sticky: 1020;
            --z-fixed: 1030;
            --z-modal: 1040;
            --z-popover: 1050;
            --z-tooltip: 1060;
        }

        /* Modern CSS Reset */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html,
        body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            font-family: var(--font-primary);
            font-size: var(--font-size-sm);
            line-height: 1.5;
            color: var(--text-light-primary);
            background: var(--background-light);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            gap: var(--spacing-xs);
        }

        .button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border: none;
            background: transparent;
            border-radius: var(--radius-full);
            color: var(--text-light-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .button:hover {
            background: var(--hover-light);
            color: var(--text-light-primary);
        }

        .button:active {
            background: var(--active-light);
            transform: scale(0.95);
        }

        .button svg {
            width: 20px;
            height: 20px;
        }

        /* Enhanced URL Bar */
        #url-bar-container {
            flex: 1;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            background: var(--background-light);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-full);
            padding: 0 var(--spacing-md);
            height: 40px;
            transition: all var(--transition-slow);
            position: relative;
        }

        .search-engine-logo {
            width: 24px;
            height: 24px;
            object-fit: contain;
            margin-right: var(--spacing-sm);
        }

        .search-engine-logo.google {
            content: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="%234285F4" d="M45.12 24.5c0-1.56-.14-3.06-.4-4.5H24v8.51h11.84c-.51 2.75-2.06 5.08-4.39 6.64v5.52h7.11c4.16-3.83 6.56-9.47 6.56-16.17z"/><path fill="%2334A853" d="M24 46c5.94 0 10.92-1.97 14.56-5.33l-7.11-5.52c-1.97 1.32-4.49 2.1-7.45 2.1-5.73 0-10.58-3.87-12.31-9.07H4.34v5.7C7.96 41.07 15.4 46 24 46z"/><path fill="%23FBBC05" d="M11.69 28.18C11.25 26.86 11 25.45 11 24s.25-2.86.69-4.18v-5.7H4.34C2.85 17.09 2 20.45 2 24c0 3.55.85 6.91 2.34 9.88l7.35-5.7z"/><path fill="%23EA4335" d="M24 10.75c3.23 0 6.13 1.11 8.41 3.29l6.31-6.31C34.91 4.18 29.93 2 24 2 15.4 2 7.96 6.93 4.34 14.12l7.35 5.7c1.73-5.2 6.58-9.07 12.31-9.07z"/></svg>');
        }

        .search-engine-logo.bing {
            content: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="%23008373" d="M11.4 5.4v32.6l8.5 4.7 18.2-10.5v-8.9l-16.9 7.1 1.1-19.6z"/></svg>');
        }

        .search-engine-logo.duckduckgo {
            content: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="%23DE5833" d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4z"/><path fill="%23FFF" d="M33.5 22.5c0 5.25-4.25 9.5-9.5 9.5s-9.5-4.25-9.5-9.5 4.25-9.5 9.5-9.5 9.5 4.25 9.5 9.5z"/></svg>');
        }

        .search-engine-logo.yahoo {
            content: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="%234A089F" d="M24.5 4L35 26.5l10.5-22.5h-21zM12 46l12-25.5L36 46H12z"/></svg>');
        }

        #url-bar-container:focus-within {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
            transition: all var(--transition-slow);
        }

        .site-info {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        #site-favicon {
            width: 16px;
            height: 16px;
            object-fit: contain;
        }

        #site-security {
            font-size: var(--font-size-xs);
            color: var(--text-light-secondary);
        }

        #url-bar {
            flex: 1;
            border: none;
            background: transparent;
            font-size: var(--font-size-sm);
            color: var(--text-light-primary);
            outline: none;
            padding: 0;
        }


        #url-bar::placeholder {
            color: var(--text-light-secondary);
        }

        /* Tab Bar Enhancements */
        #tab-bar {
            display: flex;
            gap: 2px;
            padding: var(--spacing-xs) var(--spacing-sm) 0;
            background: var(--surface-medium);
            user-select: none;
            overflow-x: auto;
            flex-wrap: nowrap;
        }

        .tab {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            min-width: 150px;
            max-width: 200px;
            height: 36px;
            padding: 0 var(--spacing-sm);
            background: var(--hover-light);
            border-radius: var(--radius-md) var(--radius-md) 0 0;
            cursor: pointer;
            transition: all var(--transition-fast);
            flex: 1;
            white-space: nowrap;
        }

        .ntab {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            min-width: 25px;
            max-width: 25px;
            height: 36px;
            padding: 0 var(--spacing-sm);
            border-radius: var(--radius-md) var(--radius-md) 0 0;
            cursor: pointer;
            transition: all var(--transition-fast);
            flex: 1;
            white-space: nowrap;
        }

        .tab.active {
            background: var(--background-light);
            box-shadow: var(--shadow-sm);
        }

        .tab-favicon {
            width: 16px;
            height: 16px;
            object-fit: contain;
        }

        .tab-title {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: var(--font-size-xs);
            color: var(--text-light-secondary);
        }

        .tab.active .tab-title {
            color: var(--text-light-primary);
        }

        .tab.active .tab-title {
            color: var(--text-light-primary);
        }

        /* Container styles */
        #browser-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* Enhanced top bar styles */
        #top-bar {
            background: var(--background-light);
            padding: var(--spacing-sm) var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            box-shadow: 0 2px 4px var(--shadow-light);
            position: relative;
            z-index: 100;
        }
        
        /* Bookmarks bar styles */
        #bookmarks-bar {
            display: flex;
            padding: 0px 6px;
            background-color: #fff;
            border-bottom: 1px solid #dadce0;
            overflow-x: auto;
        }
        .bookmark {
            margin-right: 15px;
            cursor: pointer;
            white-space: nowrap;
            font-size: 12px;
            color: #3c4043;
            display: flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        .bookmark:hover {
            background-color: #e8eaed;
        }
        .bookmark-favicon {
            width: 16px;
            height: 16px;
            margin-right: 5px;
        }

        /* Enhanced URL bar styles */
        #url-bar-container {
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
            background: var(--hover-light);
            border-radius: 24px;
            padding: 0 var(--spacing-md);
            margin: 0 var(--spacing-md);
            transition: all var(--transition-speed);
            border: 1px solid transparent;
        }

        #url-bar-container:focus-within {
            background: var(--background-light);
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
        }

        #dynamicFrame {
            flex: 1;
            width: 100%;
            height: 100%;
            border: none;
        }

        #frame-container {
            flex: 1;
            display: flex;
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        #url-bar {
            flex: 1;
            border: none;
            height: 32px;
        }

        #content-area {
            flex: 1;
            display: flex;
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        @media (max-width: 480px) {
            #tab-bar {
                display: none;
            }

            #top-bar {
                flex-wrap: wrap;
            }

            #url-bar-container {
                order: -1;
                width: 100%;
                margin: var(--spacing-xs) 0;
            }

            .nav-buttons {
                width: 100%;
                justify-content: space-between;
            }
        }

        /* Accessibility styles */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Print styles */
        @media print {

            #top-bar,
            #tab-bar,
            #bookmarks-bar,
            #status-bar {
                display: none;
            }

            #content-area {
                height: max-height;
                width: max-width;
            }

        }

    </style>
</head>
<body>
    <div id="browser-container">
        <div id="tab-bar">
                <div class="tab active" onclick="switchToTab(1733188542009)" data-tab-id="1733188542009" style="width: 240px;">
                    <img src="https://www.google.com/favicon.ico" class="tab-favicon" alt="Favicon">
                    <span class="tab-title">Browser History</span>
                    <span class="tab-close" onclick="event.stopPropagation(); closeTab(1733188542009)">×</span>
                </div>
            <div class="ntab" onclick="createTab()">+</div></div>
        <div id="top-bar">
            <div class="nav-buttons">
                <button id="back-button" class="button" title="Go back" onclick="goBack()">
                    <svg viewBox="0 0 24 24">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"></path>
                    </svg>
                </button>
                <button id="forward-button" class="button" title="Go forward" onclick="goForward()">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"></path>
                    </svg>
                </button>
                <button id="reload-button" class="button" title="Reload" onclick="refreshPage()">
                    <svg viewBox="0 0 24 24">
                        <path d="M17.65 6.35A7.958 7.958 0 0012 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0112 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"></path>
                    </svg>
                </button>
            </div>
            <div id="url-bar-container">
                <img id="search-engine-logo" class="search-engine-logo duckduckgo" alt="Search engine logo">
                <input type="text" id="url-bar" placeholder="Search Google or type a URL">
                <button class="button" onclick="showAddBookmarkMenu()">★</button>
            </div>
            <button id="settings-button" class="button" title="Settings">
                <svg viewBox="0 0 24 24">
                    <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"></path>
                </svg>
            </button>
        </div>
        <div id="bookmarks-bar"></div>
        <div id="content-area">
            <div id="frame-container">
                <iframe id="dynamicFrame"  is="x-frame-bypass" src="https://google.com"  sandbox="allow-scripts allow-same-origin allow-forms X-Frame-Options: SAMEORIGIN" srcdoc="" ></iframe>
            </div>
        </div>
    </div>
    <div id="context-menu" style="display: none;"></div> 

   <script>
        // DOM Elements
        const frame = document.getElementById('dynamicFrame');
        const urlBar = document.getElementById('url-bar');
        const tabBar = document.getElementById('tab-bar');
        const bookmarksBar = document.getElementById('bookmarks-bar');
        const statusText = document.getElementById('status-text');
        const contextMenu = document.getElementById('context-menu');
        const searchSuggestions = document.getElementById('search-suggestions');
        const devTools = document.getElementById('dev-tools');
        const devToolsContent = document.getElementById('dev-tools-content');
        const downloadsPanel = document.getElementById('downloads-panel');
        const historyPanel = document.getElementById('history-panel');
        const readerMode = document.getElementById('reader-mode');
        const readerContent = document.getElementById('reader-content');
        const zoomLevel = document.getElementById('zoom-level');
        const adBlockerStatus = document.getElementById('ad-blocker-status');

        // State variables
        let tabs = [];
        let activeTabId = null;
        let bookmarks = [
                        {
                            id: 1,
                            url: 'ssnnd0://new-tab',
                            title: 'New Tab',
                            favicon: 'icons/a.png'
                        },
                        {
                            id: 2,
                            url: 'ssnnd0://history',
                            title: 'History',
                            favicon: 'icons/a.png'
                        },
                        {
                            id: 3,
                            url: 'ssnnd0://bookmarks',
                            title: 'Bookmarks',
                            favicon: 'icons/a.png'
                        },
                        {
                            id: 4,
                            url: 'ssnnd0://settings',
                            title: 'Settings',
                            favicon: 'icons/a.png'
                        },
                        {
                            id: 5,
                            url: 'ssnnd0://downloads',
                            title: 'Downloads',
                            favicon: 'icons/a.png'
                        },
                        {
                            id: 6,
                            url: 'ssnnd0://extensions',
                            title: 'Extensions',
                            favicon: 'icons/a.png'
                        },
                        {
                            id: 7,
                            url: 'ssnnd0://about',
                            title: 'About',
                            favicon: 'icons/a.png'
                        },
                        {
                            id: 8,
                            url: 'ssnnd0://developer',
                            title: 'Developer Tools',
                            favicon: 'icons/a.png'
                        },
                        {
                            id: 9,
                            url: 'ssnnd0://privacy',
                            title: 'Privacy',
                            favicon: 'icons/a.png'
                        },
                        {
                            id: 10,
                            url: 'ssnnd0://help',
                            title: 'Help Center',
                            favicon: 'icons/a.png'
                        }
        ];
        let history = [];
        let currentTheme = 'light';
        let isIncognitoMode = false;
        let downloads = [];
        let currentZoom = 100;
        let isAdBlockerOn = false;
        let isReaderModeOn = false;

        // Browser functionality
        function createTab(url = 'ssnnd0://new-tab') {
            const tab = { id: Date.now(), url, title: 'New Tab', favicon: '' };
            tabs.push(tab);
            updateTabBar();
            switchToTab(tab.id);
        }

        function updateTabBar() {
            if (!tabBar) return; // Safety check
            
            const tabsHTML = tabs.map(tab => `
                <div class="tab ${tab.id === activeTabId ? 'active' : ''}" 
                    onclick="switchToTab(${tab.id})"
                    data-tab-id="${tab.id}">
                    <img src="${tab.favicon || 'https://www.google.com/favicon.ico'}" 
                        class="tab-favicon" 
                        alt="Favicon">
                    <span class="tab-title">${tab.title || 'New Tab'}</span>
                    <span class="tab-close" 
                        onclick="event.stopPropagation(); closeTab(${tab.id})">×</span>
                </div>
            `).join('');

            tabBar.innerHTML = tabsHTML + '<div class="ntab" onclick="createTab()">+</div>';
        }

        function switchToTab(tabId) {
            activeTabId = parseInt(tabId);
            const tab = tabs.find(t => t.id === activeTabId);
            if (tab) {
                urlBar.value = tab.url;
                loadUrl();
                updateTabBar();
            }
        }

        function loadUrl() {
            let url = urlBar.value.trim();
            
            // Handle internal pages
            if (url.startsWith('ssnnd0://')) {
                loadInternalPage(url);
                updateActiveTab(url, getInternalPageTitle(url));
                return;
            }
            
            // Handle search queries and URLs
            if (!url.includes('.') || url.includes(' ')) {
                url = `https://www.google.com/search?q=${encodeURIComponent(url)}`;
            } else if (!url.startsWith('http://') && !url.startsWith('https://')) {
                url = 'https://' + url;
            }
            
            // Update iframe src and tab info
            frame.src = url;
            updateActiveTab(url);
            if (!isIncognitoMode) {
                addToHistory(url);
            }
        }

        function getInternalPageTitle(url) {
            const titles = {
                'ssnnd0://new-tab': 'New Tab',
                'ssnnd0://history': 'History',
                'ssnnd0://bookmarks': 'Bookmarks',
                'ssnnd0://settings': 'Settings',
                'ssnnd0://downloads': 'Downloads',
                'ssnnd0://extensions': 'Extensions',
                'ssnnd0://about': 'About',
                'ssnnd0://developer': 'Developer Tools',
                'ssnnd0://privacy': 'Privacy',
                'ssnnd0://help': 'Help Center'
            };
            return titles[url] || 'Internal Page';
        }

        function loadInternalPage(url) {
            switch (url) {
                case 'ssnnd0://new-tab':
                    frame.srcdoc = generateNewTabPage();
                    break;
                case 'ssnnd0://history':
                    frame.srcdoc = generateHistoryPage();
                    break;
                case 'ssnnd0://bookmarks':
                    frame.srcdoc = generateBookmarksPage();
                    break;
                case 'ssnnd0://settings':
                    frame.srcdoc = generateSettingsPage();
                    break;
                case 'ssnnd0://downloads':
                    frame.srcdoc = generateDownloadsPage();
                    break;
                case 'ssnnd0://extensions':
                    frame.srcdoc = generateExtensionsPage();
                    break;
                case 'ssnnd0://developer':
                    frame.srcdoc = generateDeveloperPage();
                    break;
                case 'ssnnd0://privacy':
                    frame.srcdoc = generatePrivacyPage();
                    break;
                case 'ssnnd0://help':
                    frame.srcdoc = generateHelpPage();
                    break;
                case 'ssnnd0://about':
                    frame.srcdoc = generateAboutPage();
                    break;
                case 'ssnnd0://themes':
                    frame.srcdoc = generateThemesPage();
                    break;
                case 'ssnnd0://passwords':
                    frame.srcdoc = generatePasswordsPage();
                    break;
                case 'ssnnd0://apps':
                    frame.srcdoc = generateAppsPage();
                    break;
                default:
                    frame.srcdoc = generateErrorPage();
            }
        }

        function generateNewTabPage() {
            const savedColor = localStorage.getItem('bgColor') || '#f1f3f4';
            return `
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>New Tab</title>
                    <style>
                        body {
                            font-family: 'Roboto', Arial, sans-serif;
                            margin: 0;
                            padding: 0;
                            color: #202124;
                            display: flex;
                            flex-direction: column;
                            min-height: 100vh;
                            transition: background-color 0.3s;
                            background-color: ${savedColor};
                        }
                        .container {
                            flex-grow: 1;
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                            justify-content: center;
                            padding: 20px;
                        }
                        .logo {
                            font-size: 72px;
                            font-weight: 400;
                            color: #5f6368;
                            margin-bottom: 20px;
                        }
                        .search-bar {
                            width: 80%;
                            max-width: 600px;
                            margin-bottom: 40px;
                            position: relative;
                        }
                        .search-bar input {
                            width: 100%;
                            padding: 12px 50px 12px 20px;
                            border-radius: 24px;
                            border: 1px solid #dfe1e5;
                            font-size: 16px;
                            outline: none;
                            transition: box-shadow 0.3s;
                        }
                        .search-bar input:focus {
                            box-shadow: 0 1px 6px rgba(32,33,36,.28);
                            border-color: rgba(223,225,229,0);
                        }
                        .search-bar .search-icon {
                            position: absolute;
                            right: 15px;
                            top: 50%;
                            transform: translateY(-50%);
                            color: #5f6368;
                            cursor: pointer;
                        }
                        .bookmarks-grid {
                            display: grid;
                            grid-template-columns: repeat(auto-fill, minmax(112px, 1fr));
                            gap: 16px;
                            width: 100%;
                            max-width: 600px;
                        }
                        .bookmark-tile {
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                            text-decoration: none;
                            color: #202124;
                            padding: 16px;
                            border-radius: 4px;
                            transition: background-color 0.3s;
                        }
                        .bookmark-tile:hover {
                            background-color: #e8f0fe;
                        }
                        .bookmark-icon {
                            width: 48px;
                            height: 48px;
                            border-radius: 50%;
                            margin-bottom: 8px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            background-color: #f1f3f4;
                        }
                        .bookmark-icon img {
                            width: 24px; 
                            height:auto; 
                            object-fit:center; 
                        }
                        
                        .bookmark-title {
                            font-size:auto; 
                            text-align:center; 
                            white-space:no-wrap; 
                            overflow:hidden; 
                            text-overflow:none; 
                            width:auto; 
                        }
                        
                        .customization {
                            position:absolute; 
                            bottom:auto; 
                            right:auto; 
                            background-color:#fff; 
                            padding:auto; 
                            border-radius:auto; 
                            box-shadow:auto; 
                        }
                        
                        .color-picker {
                            width:auto; 
                            height:auto; 
                            border:none; 
                            cursor:pointer; 
                        }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <div class="logo">ssnnd0</div>
                        <div class="search-bar">
                        <input type="text" id="search-input" placeholder="Search or enter web addressss">
                    </div>
                    <div class="bookmarks-grid">
                        ${bookmarks.slice(0, 8).map(b => `
                            <a href="${b.url}" class="bookmark-tile">
                                <div class="bookmark-icon">
                                    <img src="${b.favicon || 'default-favicon.ico'}" alt="${b.title}" onerror="this.src='default-favicon.ico';">
                                </div>
                                <div class="bookmark-title">${b.title}</div>
                            </a>
                        `).join('')}
                    </div>
                </div>

                <div class="customization">
                    <input type="color" id="bgColorPicker" class="color-picker" value="${savedColor}">
                </div>
            </body>
            </html>
            `;
        }

        // Set up event listeners after generating the new tab page
        function setupNewTabEvents() {
            document.getElementById('search-icon').addEventListener('click', performSearch);
            document.getElementById('bgColorPicker').addEventListener('change', function(event) {
                const color = event.target.value;
                document.body.style.backgroundColor = color;
                localStorage.setItem('bgColor', color);
            });
            
            document.getElementById('search-input').addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    performSearch();
                }
            });
        }

        function performSearch() {
            const query = document.getElementById('search-input').value.trim();
            if (query) {
                if (isValidURL(query)) {
                    parent.loadUrl(query);
                } else {
                    parent.loadUrl(`https://www.google.com/search?q=${encodeURIComponent(query)}`);
                }
            }
        }

        function isValidURL(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        // Load saved background color on page load
        document.addEventListener('DOMContentLoaded', () => {
            const savedColor = localStorage.getItem('bgColor');
            if (savedColor) {
                document.body.style.backgroundColor = savedColor;
                document.getElementById('bgColorPicker').value = savedColor;
            }
        });

        function generateHistoryPage() {
            return `
                <title>Browser History</title>
                <style>
                    body {
                        font-family: 'Roboto', Arial, sans-serif;
                        margin: 0;
                        padding: 0;
                        background-color: #f1f3f4;
                        color: #202124;
                    }
                    .container {
                        max-width: 1200px;
                        margin: 0 auto;
                        padding: 20px;
                    }
                    h1 {
                        font-size: 22px;
                        font-weight: 400;
                        margin-bottom: 20px;
                    }
                    .search-bar {
                        display: flex;
                        margin-bottom: 20px;
                    }
                    .search-bar input {
                        flex-grow: 1;
                        padding: 10px;
                        border: 1px solid #dfe1e5;
                        border-radius: 24px;
                        font-size: 16px;
                    }
                    .history-list {
                        list-style-type: none;
                        padding: 0;
                    }
                    .history-item {
                        background-color: #fff;
                        border-radius: 8px;
                        margin-bottom: 10px;
                        padding: 12px;
                        display: flex;
                        align-items: center;
                        transition: background-color 0.2s;
                    }
                    .history-item:hover {
                        background-color: #f8f9fa;
                    }
                    .favicon {
                        width: 16px;
                        height: 16px;
                        margin-right: 12px;
                    }
                    .item-details {
                        flex-grow: 1;
                    }
                    .item-title {
                        color: #1a73e8;
                        text-decoration: none;
                        font-size: 14px;
                        font-weight: 500;
                        margin-bottom: 4px;
                        display: block;
                    }
                    .item-url {
                        color: #5f6368;
                        font-size: 12px;
                    }
                    .item-time {
                        color: #5f6368;
                        font-size: 12px;
                        white-space: nowrap;
                    }
                    .more-options {
                        color: #5f6368;
                        background: none;
                        border: none;
                        cursor: pointer;
                        padding: 4px;
                        margin-left: 8px;
                    }
                </style>
                <div class="container">
                    <h1>Browser History</h1>
                    <div class="search-bar">
                        <input type="text" placeholder="Search history">
                    </div>
                    <ul class="history-list">
                        ${history.map(h => `
                            <li class="history-item">
                                <img class="favicon" src="https://www.google.com/s2/favicons?domain=${new URL(h.url).hostname}" alt="Favicon">
                                <div class="item-details">
                                    <a href="${h.url}" class="item-title">${h.title || h.url}</a>
                                    <div class="item-url">${h.url}</div>
                                </div>
                                <div class="item-time">${new Date(h.timestamp).toLocaleString()}</div>
                                <button class="more-options">⋮</button>
                            </li>
                        `).join('')}
                    </ul>
                </div>
            `;
        }

        function generateBookmarksPage() {
            return `
                <title>Bookmarks</title>
                <style>
                body {
                    font-family: 'Roboto', Arial, sans-serif;
                    margin: 0;
                    padding: 0;
                    background-color: #f1f3f4;
                    color: #202124;
                }
                .container {
                    max-width: 1200px;
                    margin: 0 auto;
                    padding: 20px;
                }
                .internal-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 20px;
                }
                h1 {
                    font-size: 22px;
                    font-weight: 400;
                    margin: 0;
                }
                .header-actions {
                    display: flex;
                    gap: 10px;
                }
                button {
                    background-color: #1a73e8;
                    color: white;
                    border: none;
                    padding: 8px 16px;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 14px;
                    transition: background-color 0.2s;
                }
                button:hover {
                    background-color: #1765cc;
                }
                .search-bar {
                    margin-bottom: 20px;
                }
                .search-bar input {
                    width: 100%;
                    padding: 10px;
                    border: 1px solid #dfe1e5;
                    border-radius: 24px;
                    font-size: 16px;
                }
                .bookmark-folder {
                    background-color: #fff;
                    border-radius: 8px;
                    padding: 16px;
                    margin-bottom: 20px;
                }
                .folder-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 12px;
                }
                h2 {
                    font-size: 16px;
                    font-weight: 500;
                    margin: 0;
                }
                .bookmark-list {
                    list-style-type: none;
                    padding: 0;
                    margin: 0;
                }
                .bookmark-item {
                    display: flex;
                    align-items: center;
                    padding: 8px 0;
                    border-bottom: 1px solid #f1f3f4;
                }
                .bookmark-item:last-child {
                    border-bottom: none;
                }
                .favicon {
                    width: 16px;
                    height: 16px;
                    margin-right: 12px; 
                }
                .bookmark-link {
                    color: #1a73e8; 
                    text-decoration: none; 
                    font-size: 14px; 
                    flex-grow: 1; 
                }
                .bookmark-actions {
                    opacity: 0; 
                    transition: opacity 0.2s; 
                }
                .bookmark-item:hover .bookmark-actions { 
                    opacity: 1; 
                }
                .action-button { 
                    background:none; 
                    border:none; 
                    color:#5f6368; 
                    cursor:pointer; 
                    padding:4px; 
                }
                .notification { 
                    position:absolute; 
                    bottom:-30%; 
                    right:-30%; 
                    background-color:#323232; 
                    color:white; 
                    padding:12px 24px; 
                    border-radius:4px; 
                    box-shadow:
                        0
                        4px
                        6px
                        rgba(0,0,0,0.1); 
                    z-index:
                        1000; 
                    font-size:
                        14px; 
                    display:flex; 
                    align-items:center; 
                    animation:
                        slideIn
                        .3s
                        ease-out,
                        fadeOut
                        .5s
                        ease-in
                        3s forwards
                }   
                .notification-icon { 
                    margin-right:
                        12px; 
                    display:flex; 
                    align-items:center; 
                }   
                .notification-close {  
                    margin-left:
                        12px;  
                    background:none;  
                    border:none;  
                    color:
                        rgba(255,255,255,0.7);  
                    cursor:pointer;  
                }   
                @keyframes slideIn {   
                    from { transform:
                        translateY(20px); opacity:
                        0;}
                    to { transform:
                        translateY(0); opacity:
                        1;}
                }   
                @keyframes fadeOut {   
                    from { opacity:
                        1;}  
                    to { opacity:
                        0; transform:
                        translateY(20px);}
                }   
            </style>
        </head>
        <body>
            <div class="container">
                <div class="internal-header">
                    <h1>Bookmarks</h1>
                    <div class="header-actions">
                        <button onclick="showAddBookmarkMenu()">Add Bookmark</button>
                        <button onclick="importBookmarks()">Import</button>
                        <button onclick="exportBookmarks()">Export</button>
                    </div>
                </div>
                
                <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Search bookmarks" oninput="filterBookmarks()">
            </div>

            <div id="bookmarksList"></div> <!-- Container for bookmarks -->
        </div>

            `;
        }

        function generateSettingsPage() {
            return `
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>Settings</title>
                <style>
                    body {
                        font-family: 'Roboto', Arial, sans-serif;
                        margin: 0;
                        padding: 0;
                        background-color: #f1f3f4;
                        color: #202124;
                    }
                    .settings-container {
                        max-width: 800px;
                        margin: 0 auto;
                        padding: 20px;
                        background-color: #fff;
                        box-shadow: 0 1px 2px 0 rgba(60,64,67,0.3), 0 2px 6px 2px rgba(60,64,67,0.15);
                    }
                    .settings-section {
                        margin-bottom: 40px;
                    }
                    h1 {
                        font-size: 22px;
                        font-weight: 400;
                        color: #3c4043;
                        margin-bottom: 20px;
                        padding-bottom: 10px;
                        border-bottom: 1px solid #dadce0;
                    }
                    .settings-group {
                        margin-bottom: 30px;
                    }
                    h2 {
                        font-size: 16px;
                        font-weight: 500;
                        color: #3c4043;
                        margin-bottom: 15px;
                    }
                    .settings-row {
                        display: flex;
                        align-items: center;
                        padding: 10px 0;
                        border-bottom: 1px solid #f1f3f4;
                    }
                    .settings-row:last-child {
                        border-bottom: none;
                    }
                    label {
                        display: flex;
                        align-items: center;
                        font-size: 14px;
                        color: #3c4043;
                        cursor: pointer;
                    }
                    input[type="checkbox"] {
                        margin-right: 10px;
                        width: 16px;
                        height: 16px;
                    }
                    .setting-description {
                        flex-grow: 1;
                    }
                    .setting-control {
                        display: flex;
                        align-items: center;
                    }
                    select {
                        padding: 5px 10px;
                        border: 1px solid #dadce0;
                        border-radius: 4px;
                        font-size: 14px;
                        color: #3c4043;
                    }
                    .button {
                        background-color: #1a73e8;
                        color: white;
                        border: none;
                        padding: 8px 16px;
                        border-radius: 4px;
                        font-size: 14px;
                        cursor: pointer;
                        transition: background-color 0.2s;
                    }
                    .button:hover {
                        background-color: #1765cc;
                    }
                </style>
                <div class="settings-container">
                    <div class="settings-section">
                        <h1>Settings</h1>
                        <div class="settings-group">
                            <h2>Privacy</h2>
                            <div class="settings-row">
                                <div class="setting-description">
                                    <label>
                                        <input type="checkbox" id="incognitoMode" onchange="toggleIncognitoMode()">
                                        Use Incognito mode
                                    </label>
                                    <div>Browse privately, and prevent your activity from being saved to your browser history</div>
                                </div>
                            </div>
                            <div class="settings-row">
                                <div class="setting-description">
                                    <label>
                                        <input type="checkbox" id="allowCookies" checked onchange="toggleCookies()">
                                        Allow cookies
                                    </label>
                                    <div>Allow sites to save and read cookie data</div>
                                </div>
                            </div>
                            <div class="settings-row">
                                <div class="setting-description">
                                    <label>
                                        <input type="checkbox" id="doNotTrack" checked onchange="toggleTracking()">
                                        Send a "Do Not Track" request with your browsing traffic
                                    </label>
                                    <div>Requests that websites do not track your browsing habits</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="settings-section">
                        <h1>Advanced</h1>
                        <div class="settings-group">
                            <h2>System</h2>
                            <div class="settings-row">
                                <div class="setting-description">
                                    <label>
                                        <input type="checkbox" id="adBlocker" onchange="toggleAdBlocker()">
                                        Use ad blocker
                                    </label>
                                    <div>Block advertisements on websites you visit</div>
                                </div>
                            </div>
                            <div class="settings-row">
                                <div class="setting-description">
                                    <label>
                                        <input type="checkbox" id="readerMode" onchange="toggleReaderMode()">
                                        Enable Reader mode
                                    </label>
                                    <div>Simplify page layout for reading</div>
                                </div>
                            </div>
                        </div>
                        <div class="settings-group">
                            <h2>Languages</h2>
                            <div class="settings-row">
                                <div class="setting-description">
                                    <div>Language</div>
                                    <div>Select your preferred language for browser UI</div>
                                </div>
                                <div class="setting-control">
                                    <select id="language" onchange="changeLanguage()">
                                        <option value="en">English</option>
                                        <option value="es">Español</option>
                                        <option value="fr">Français</option>
                                        <option value="de">Deutsch</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="settings-group">
                            <h2>Reset settings</h2>
                            <div class="settings-row">
                                <div class="setting-description">
                                    <div>Restore settings to their original defaults</div>
                                    <div>This will reset your startup page, new tab page, search engine, and pinned tabs. It will also clear temporary data like cookies. Your bookmarks, history and saved passwords will not be cleared.</div>
                                </div>
                                <div class="setting-control">
                                    <button class="button" onclick="resetSettings()">Reset settings</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateDownloadsPage() {
            return `
                <title>Downloads</title>
                <div class="internal-page">
                    <div class="internal-header">
                        <h1>Downloads</h1>
                        <p>Manage and analyze your download history</p>
                    </div>
                    <div class="downloads-list">
                        ${downloads.map(d => `
                            <div class="download-item">
                                ${d.filename} - ${d.progress}%
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function generateExtensionsPage() {
            return `
                <title>Extensions</title>
                <div style="padding: 20px; font-family: Arial, sans-serif;">
                    <h1>Browser Extensions</h1>
                    <div class="extensions-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                        <div class="extension-card" style="border: 1px solid #dadce0; padding: 15px; border-radius: 8px;">
                            <h3>Ad Blocker</h3>
                            <p>Block unwanted ads and trackers</p>
                            <label class="switch">
                                <input type="checkbox" ${isAdBlockerOn ? 'checked' : ''} onchange="parent.toggleAdBlocker()">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="extension-card" style="border: 1px solid #dadce0; padding: 15px; border-radius: 8px;">
                            <h3>Reader Mode</h3>
                            <p>Clean reading experience</p>
                            <label class="switch">
                                <input type="checkbox" ${isReaderModeOn ? 'checked' : ''} onchange="parent.toggleReaderMode()">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateDeveloperPage() {
            return `
                <title>Developer Tools</title>
                <div class="internal-page">
                    <div class="internal-header">
                        <h1>Developer Tools</h1>
                        <p>Web development and debugging tools</p>
                    </div>
                    <div class="dev-tools-content">
                        <div class="dev-tools-section">
                            <h2>Quick Actions</h2>
                            <button onclick="parent.toggleDevTools()" class="dev-button">
                                Toggle Dev Tools Panel
                            </button>
                            <button onclick="eruda.show('console')" class="dev-button">
                                Open Console
                            </button>
                            <button onclick="eruda.show('elements')" class="dev-button">
                                Inspect Elements
                            </button>
                            <button onclick="eruda.show('network')" class="dev-button">
                                Network Panel
                            </button>
                        </div>
                        <div class="dev-tools-section">
                            <h2>Available Tools</h2>
                            <ul class="dev-tools-list">
                                <li>Console</li>
                                <li>Elements Inspector</li>
                                <li>Network Monitor</li>
                                <li>Resources</li>
                                <li>Sources</li>
                                <li>Performance</li>
                            </ul>
                        </div>
                        <div class="dev-tools-section">
                            <h2>Keyboard Shortcuts</h2>
                            <div class="shortcuts-grid">
                                <div class="shortcut">
                                    <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>I</kbd>
                                    <span>Toggle Dev Tools</span>
                                </div>
                                <div class="shortcut">
                                    <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>C</kbd>
                                    <span>Inspect Elements</span>
                                </div>
                                <div class="shortcut">
                                    <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>J</kbd>
                                    <span>Open Console</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generatePrivacyPage() {
            return `
                <title>Privacy Settings</title>
                <div style="padding: 20px; font-family: Arial, sans-serif;">
                    <h1>Privacy Settings</h1>
                    <div class="privacy-settings" style="margin-top: 20px;">
                        <div class="setting-row" style="margin-bottom: 15px;">
                            <label>
                                <input type="checkbox" ${isIncognitoMode ? 'checked' : ''} onchange="parent.toggleIncognitoMode()">
                                Incognito Mode
                            </label>
                        </div>
                        <div class="setting-row" style="margin-bottom: 15px;">
                            <label>
                                <input type="checkbox" checked onchange="parent.toggleCookies()">
                                Allow Cookies
                            </label>
                        </div>
                        <div class="setting-row" style="margin-bottom: 15px;">
                            <label>
                                <input type="checkbox" checked onchange="parent.toggleTracking()">
                                Do Not Track
                            </label>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateHelpPage() {
            return `
                <title>Help Center</title>
                <div style="padding: 20px; font-family: Arial, sans-serif;">
                    <h1>Help Center</h1>
                    <div class="help-sections" style="margin-top: 20px;">
                        <h2>Keyboard Shortcuts</h2>
                        <ul style="list-style-type: none; padding: 0;">
                            <li style="margin: 10px 0;">
                                <kbd style="background: #f8f9fa; padding: 3px 6px; border-radius: 3px;">Ctrl + T</kbd>
                                New Tab
                            </li>
                            <li style="margin: 10px 0;">
                                <kbd style="background: #f8f9fa; padding: 3px 6px; border-radius: 3px;">Ctrl + W</kbd>
                                Close Tab
                            </li>
                            <li style="margin: 10px 0;">
                                <kbd style="background: #f8f9fa; padding: 3px 6px; border-radius: 3px;">Ctrl + R</kbd>
                                Refresh Page
                            </li>
                        </ul>
                        <h2>Features</h2>
                        <ul>
                            <li>Ad Blocker</li>
                            <li>Reader Mode</li>
                            <li>Developer Tools</li>
                            <li>Privacy Settings</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function generateAboutPage() {
            return `
                <title>About</title>
                <div class="internal-page">
                    <div class="internal-header">
                        <h1>About</h1>
                        <p>Information about the browser and its developers</p>
                    </div>
                    <div class="about-content">
                        <h2>Browser Version</h2>
                        <p>0.5.2 beta</p>
                        <h2>Developers</h2>
                        <p>Sandro Thornton (<a href="https://github.com/ssnnd0">ssnnd0</a>)</p>
                        <h2>License</h2>
                        <p>MIT License</p>
                    </div>
                </div>
            `;
        }

        function generateThemesPage() {
            return `
                <title>Themes</title>
                <div class="internal-page">
                    <div class="internal-header">
                        <h1>Browser Themes</h1>
                        <p>Customize your browsing experience</p>
                    </div>
                    <div class="themes-grid">
                        <div class="theme-card" onclick="parent.applyTheme('light')">
                            <div class="theme-preview light-theme"></div>
                            <span>Light Theme</span>
                        </div>
                        <div class="theme-card" onclick="parent.applyTheme('dark')">
                            <div class="theme-preview dark-theme"></div>
                            <span>Dark Theme</span>
                        </div>
                        <div class="theme-card" onclick="parent.applyTheme('sepia')">
                            <div class="theme-preview sepia-theme"></div>
                            <span>Sepia Theme</span>
                        </div>
                        <div class="theme-card" onclick="parent.applyTheme('nord')">
                            <div class="theme-preview nord-theme"></div>
                            <span>Nord Theme</span>
                        </div>
                    </div>
                    <div class="custom-theme-section">
                        <h2>Custom Theme</h2>
                        <div class="color-pickers">
                            <div class="color-picker">
                                <label>Background Color</label>
                                <input type="color" onchange="parent.updateCustomTheme('background', this.value)">
                            </div>
                            <div class="color-picker">
                                <label>Text Color</label>
                                <input type="color" onchange="parent.updateCustomTheme('text', this.value)">
                            </div>
                            <div class="color-picker">
                                <label>Accent Color</label>
                                <input type="color" onchange="parent.updateCustomTheme('accent', this.value)">
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generatePasswordsPage() {
            return `
                <title>Passwords</title>
                <div class="internal-page">
                    <div class="internal-header">
                        <h1>Saved Passwords</h1>
                        <p>Manage your saved passwords securely</p>
                    </div>
                    <div class="passwords-list">
                        ${savedPasswords.map(p => `
                            <div class="password-item">
                                <div class="site-info">
                                    <img src="https://www.google.com/s2/favicons?domain=${encodeURIComponent(p.domain)}" alt="Site icon">
                                    <span>${p.domain}</span>
                                </div>
                                <div class="username">${p.username}</div>
                                <div class="password-actions">
                                    <button onclick="parent.showPassword(${p.id})">Show</button>
                                    <button onclick="parent.deletePassword(${p.id})">Delete</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function generateAppsPage() {
            return `
                <title>Browser Apps</title>
                <div class="internal-page">
                    <div class="internal-header">
                        <h1>Browser Apps</h1>
                        <p>Quick access to web applications</p>
                    </div>
                    <div class="apps-grid">
                        <div class="app-card" onclick="parent.loadUrl('https://mail.google.com')">
                            <img src="https://www.google.com/gmail/about/static/images/logo-gmail.png?cache=1adba63" alt="Gmail">
                            <span>Gmail</span>
                        </div>
                        <div class="app-card" onclick="parent.loadUrl('https://calendar.google.com')">
                            <img src="https://ssl.gstatic.com/calendar/images/dynamiclogo/2x/cal_31_v2.png" alt="Calendar">
                            <span>Calendar</span>
                        </div>
                        <div class="app-card" onclick="parent.loadUrl('https://drive.google.com')">
                            <img src="https://ssl.gstatic.com/docs/doclist/images/drive_2022q3_32dp.png" alt="Drive">
                            <span>Drive</span>
                        </div>
                        <!-- Add more app cards as needed -->
                    </div>
                </div>
            `;
        }

        function generateErrorPage() {
            return `
                <title>Page Not Found</title>
                <div style="padding: 40px; text-align: center; font-family: Arial, sans-serif;">
                    <h1 style="color: #5f6368; margin-bottom: 20px;">Page Not Found</h1>
                    <p style="color: #3c4043; margin-bottom: 30px;">
                        The requested page could not be found. Please check the URL and try again.
                    </p>
                    <button onclick="parent.goBack()" style="padding: 10px 20px; background: #1a73e8; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        Go Back
                    </button>
                </div>
            `;
        }

        function updateActiveTab(url, title, favicon) {
            const tab = tabs.find(t => t.id === activeTabId);
            if (tab) {
                tab.url = url;
                tab.title = title || url;
                tab.favicon = favicon || '';
                updateTabBar();
            }
        }

        function closeTab(tabId) {
            if (tabs.length > 1) {
                tabs = tabs.filter(t => t.id !== tabId);
                activeTabId = tabs[tabs.length - 1].id;
                updateTabBar();
                switchToTab(activeTabId);
            }
        }

        function addBookmark() {
            const url = urlBar.value;
            const title = frame.contentDocument.title || url;
            const favicon = frame.contentDocument.querySelector('link[rel*="icon"]')?.href || 'default-favicon.ico';
            const newBookmark = { title, url, favicon, dateAdded: new Date().toISOString() };
            bookmarks.push(newBookmark);
            updateBookmarksBar();
            saveBookmarks();
            showNotification('Bookmark added successfully');
        }

        // Improved renameBookmark function
        function renameBookmark(url) {
            const bookmark = bookmarks.find(b => b.url === url);
            if (bookmark) {
                const newTitle = prompt("Enter new name for the bookmark:", bookmark.title);
                if (newTitle && newTitle.trim() !== '') {
                    bookmark.title = newTitle.trim();
                    updateBookmarksBar();
                    saveBookmarks();
                    showNotification('Bookmark renamed successfully');
                }
            }
        }

        // Improved deleteBookmark function
        function deleteBookmark(url) {
            if (confirm('Are you sure you want to delete this bookmark?')) {
                bookmarks = bookmarks.filter(b => b.url !== url);
                updateBookmarksBar();
                saveBookmarks();
                loadInternalPage('ssnnd0://bookmarks');
                showNotification('Bookmark deleted successfully');
            }
        }

        // Improved showAddBookmarkMenu function
        function showAddBookmarkMenu() {
            const title = prompt("Enter bookmark title:");
            const url = prompt("Enter bookmark URL:");

            if (title && url) {
                if (isValidURL(url)) {
                    const newBookmark = { 
                        title: title.trim(), 
                        url: url.trim(), 
                        favicon: 'default-favicon.ico',
                        dateAdded: new Date().toISOString()
                    };
                    bookmarks.push(newBookmark);
                    updateBookmarksBar();
                    saveBookmarks();
                    showNotification('Bookmark added successfully');
                } else {
                    alert("Please enter a valid URL.");
                }
            } else {
                alert("Both title and URL are required to create a bookmark.");
            }
        }

        // Improved updateBookmarksBar function
        function updateBookmarksBar() {
            bookmarksBar.innerHTML = bookmarks.map(b => `
                <div class="bookmark" title="${b.title}">
                    <img src="${b.favicon}" class="bookmark-favicon" alt="Favicon" onerror="this.src='default-favicon.ico';">
                    <span class="bookmark-title" onclick="loadUrl('${b.url}')">${truncateString(b.title, 20)}</span>
                    <div class="bookmark-actions">
                        <!-- <button onclick="renameBookmark('${b.url}')">Rename</button>
                        <button onclick="deleteBookmark('${b.url}')">Delete</button> -->
                    </div>
                </div>
            `).join('');
        }

        // New function to save bookmarks to local storage
        function saveBookmarks() {
            localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
        }

        // New function to load bookmarks from local storage
        function loadBookmarks() {
            const savedBookmarks = localStorage.getItem('bookmarks');
            if (savedBookmarks) {
                bookmarks = JSON.parse(savedBookmarks);
                updateBookmarksBar();
            }
        }

        // New function to validate URL
        function isValidURL(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        // New function to truncate long strings
        function truncateString(str, num) {
            if (str.length <= num) {
            return str;
            }
            return str.slice(0, num) + '...';
        }

        // New function to show notifications
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.className = 'notification';
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // New function to export bookmarks
        function exportBookmarks() {
            const bookmarksString = JSON.stringify(bookmarks, null, 2);
            const blob = new Blob([bookmarksString], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'bookmarks_export.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // New function to import bookmarks
        function importBookmarks() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const importedBookmarks = JSON.parse(event.target.result);
                        bookmarks = [...bookmarks, ...importedBookmarks];
                        updateBookmarksBar();
                        saveBookmarks();
                        showNotification('Bookmarks imported successfully');
                    } catch (error) {
                        alert('Error importing bookmarks. Please make sure the file is valid JSON.');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function addToHistory(url) {
            history.unshift({ url, title: frame.contentDocument.title || url, timestamp: Date.now() });
            if (history.length > 100) history.pop();
        }

        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.body.className = `theme-${currentTheme}`;
        }

        function changeTheme(theme) {
            currentTheme = theme;
            document.body.className = `theme-${currentTheme}`;
        }

        function toggleIncognitoMode() {
            isIncognitoMode = !isIncognitoMode;
            alert(isIncognitoMode ? 'Incognito mode enabled' : 'Incognito mode disabled');
        }

        function toggleDevTools() {
            devTools.style.display = devTools.style.display === 'none' ? 'block' : 'none';
        }

        function toggleHistoryPanel() {
            historyPanel.classList.toggle('open');
            if (historyPanel.classList.contains('open')) {
                historyPanel.innerHTML = `
                    <h2 style="padding: 10px;">History</h2>
                    ${history.map(h => `
                        <div class="history-item" onclick="loadUrl('${h.url}')">
                            ${h.title} - ${new Date(h.timestamp).toLocaleString()}
                        </div>
                    `).join('')}
                `;
            }
        }

        function toggleDownloadsPanel() {
            downloadsPanel.style.display = downloadsPanel.style.display === 'none' ? 'block' : 'none';
            if (downloadsPanel.style.display === 'block') {
                downloadsPanel.innerHTML = `
                    <h2 style="padding: 10px;">Downloads</h2>
                    ${downloads.map(d => `
                        <div class="download-item">
                            ${d.filename} - ${d.progress}%
                        </div>
                    `).join('')}
                `;
            }
        }

        function toggleReaderMode() {
            isReaderModeOn = !isReaderModeOn;
            if (isReaderModeOn) {
                const content = frame.contentDocument.body.innerText;
                readerContent.innerHTML = `<h1>${frame.contentDocument.title}</h1><p>${content}</p>`;
                readerMode.style.display = 'block';
            } else {
                readerMode.style.display = 'none';
            }
        }

        function toggleAdBlocker() {
            isAdBlockerOn = !isAdBlockerOn;
            adBlockerStatus.style.display = isAdBlockerOn ? 'block' : 'none';
            alert(isAdBlockerOn ? 'Ad Blocker enabled' : 'Ad Blocker disabled');
        }

        function goBack() {
            frame.contentWindow.history.back();
        }

        function goForward() {
            frame.contentWindow.history.forward();
        }

        function refreshPage() {
            frame.src = frame.src;
        }

        urlBar.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') loadUrl();
        });

        frame.addEventListener('load', function() {
            try {
                const currentUrl = frame.contentWindow.location.href;
                const title = frame.contentDocument.title;
                
                // Update URL bar only for external pages
                if (!currentUrl.startsWith('ssnnd0://')) {
                    urlBar.value = currentUrl;
                }
                
                updateActiveTab(currentUrl, title);
                statusText.textContent = `Loaded: ${currentUrl}`;
                
                // Update favicon
                const favicon = frame.contentDocument.querySelector('link[rel*="icon"]')?.href || 'default-favicon.ico';
                updateTabFavicon(activeTabId, favicon);
            } catch (e) {
                console.error('Error updating tab info:', e);
            }
        });

        document.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            
            // Get selected text
            const selectedText = window.getSelection().toString();
            
            // Check if we're right-clicking on a link
            const clickedLink = e.target.closest('a');
            
            // Check if we're right-clicking on an image
            const clickedImage = e.target.closest('img');
            
            contextMenu.innerHTML = `
                <div class="context-menu-group">
                    <div class="context-item" onclick="goBack()">
                        <svg viewBox="0 0 24 24"><path fill="currentColor" d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"/></svg>
                        Back
                    </div>
                    <div class="context-item" onclick="goForward()">
                        <svg viewBox="0 0 24 24"><path fill="currentColor" d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z"/></svg>
                        Forward
                    </div>
                    <div class="context-item" onclick="refreshPage()">
                        <svg viewBox="0 0 24 24"><path fill="currentColor" d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/></svg>
                        Refresh
                    </div>
                </div>
                ${selectedText ? `
                    <div class="context-menu-group">
                        <div class="context-item" onclick="searchSelection('${encodeURIComponent(selectedText)}')">
                            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/></svg>
                            Search Google for "${selectedText.substring(0, 20)}${selectedText.length > 20 ? '...' : ''}"
                        </div>
                        <div class="context-item" onclick="copyText('${encodeURIComponent(selectedText)}')">
                            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg>
                            Copy
                        </div>
                    </div>
                ` : ''}
                ${clickedLink ? `
                    <div class="context-menu-group">
                        <div class="context-item" onclick="openInNewTab('${clickedLink.href}')">
                            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z"/></svg>
                            Open in New Tab
                        </div>
                        <div class="context-item" onclick="copyText('${encodeURIComponent(clickedLink.href)}')">
                            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg>
                            Copy Link Address
                        </div>
                    </div>
                ` : ''}
                ${clickedImage ? `
                    <div class="context-menu-group">
                        <div class="context-item" onclick="openImageInNewTab('${clickedImage.src}')">
                            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M19,19H5V5H19M19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M13.96,12.29L11.21,15.83L9.25,13.47L6.5,17H17.5L13.96,12.29Z"/></svg>
                            Open Image in New Tab
                        </div>
                        <div class="context-item" onclick="copyText('${encodeURIComponent(clickedImage.src)}')">
                            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg>
                            Copy Image Address
                        </div>
                        <div class="context-item" onclick="saveImage('${clickedImage.src}')">
                            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"/></svg>
                            Save Image As...
                        </div>
                    </div>
                ` : ''}
                <div class="context-menu-group">
                    <div class="context-item" onclick="addBookmark()">
                        <svg viewBox="0 0 24 24"><path fill="currentColor" d="M17,3H7A2,2 0 0,0 5,5V21L12,18L19,21V5C19,3.89 18.1,3 17,3Z"/></svg>
                        Add Bookmark
                    </div>
                    <div class="context-item" onclick="toggleDevTools()">
                        <svg viewBox="0 0 24 24"><path fill="currentColor" d="M20,8H17.19C16.74,7.22 16.12,6.55 15.37,6.04L17,4.41L15.59,3L13.42,5.17C12.96,5.06 12.5,5 12,5C11.5,5 11.04,5.06 10.59,5.17L8.41,3L7,4.41L8.62,6.04C7.88,6.55 7.26,7.22 6.81,8H4V10H6.09C6.04,10.33 6,10.66 6,11V12H4V14H6V15C6,15.34 6.04,15.67 6.09,16H4V18H6.81C7.85,19.79 9.78,21 12,21C14.22,21 16.15,19.79 17.19,18H20V16H17.91C17.96,15.67 18,15.34 18,15V14H20V12H18V11C18,10.66 17.96,10.33 17.91,10H20V8Z"/></svg>
                        Inspect
                    </div>
                    <div class="context-item" onclick="printPage()">
                        <svg viewBox="0 0 24 24"><path fill="currentColor" d="M19,8H5A3,3 0 0,0 2,11V17H6V21H18V17H22V11A3,3 0 0,0 19,8M16,19H8V14H16V19M19,12A1,1 0 0,1 18,11A1,1 0 0,1 19,10A1,1 0 0,1 20,11A1,1 0 0,1 19,12Z"/></svg>
                        Print...
                    </div>
                </div>
            `;
            contextMenu.style.display = 'block';
            contextMenu.style.left = e.pageX + 'px';
            contextMenu.style.top = e.pageY + 'px';
        });

        document.addEventListener('click', () => {
            contextMenu.style.display = 'none';
        });

        // Initialize browser
        document.addEventListener('DOMContentLoaded', () => {
            createTab();
            loadExtensions();
            updateBookmarksBar();
        });

        // Add new functions for menu toggle and icon updates

        function toggleMenu() {
            const menu = document.createElement('div');
            menu.className = 'menu-dropdown';
            menu.innerHTML = `
                <div class="menu-item" onclick="toggleReaderMode()">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M19,19H5V5H19V19M17,17H7V7H17V17Z" />
                    </svg>
                    Reader Mode
                </div>
                <div class="menu-item" onclick="toggleDevTools()">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M20,8H17.19C16.74,7.22 16.12,6.55 15.37,6.04L17,4.41L15.59,3L13.42,5.17C12.96,5.06 12.5,5 12,5C11.5,5 11.04,5.06 10.59,5.17L8.41,3L7,4.41L8.62,6.04C7.88,6.55 7.26,7.22 6.81,8H4V10H6.09C6.04,10.33 6,10.66 6,11V12H4V14H6V15C6,15.34 6.04,15.67 6.09,16H4V18H6.81C7.85,19.79 9.78,21 12,21C14.22,21 16.15,19.79 17.19,18H20V16H17.91C17.96,15.67 18,15.34 18,15V14H20V12H18V11C18,10.66 17.96,10.33 17.91,10H20V8Z" />
                    </svg>
                    Developer Tools
                </div>
                <div class="menu-item" onclick="toggleHistoryPanel()">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M13.5,8H12V13L16.28,15.54L17,14.33L13.5,12.25V8M13,3A9,9 0 0,0 4,12H1L4.96,16.03L9,12H6A7,7 0 0,1 13,5A7,7 0 0,1 20,12A7,7 0 0,1 13,19C11.07,19 9.32,18.21 8.06,16.94L6.64,18.36C8.27,20 10.5,21 13,21A9,9 0 0,0 22,12A9,9 0 0,0 13,3" />
                    </svg>
                    History
                </div>
                <div class="menu-item" onclick="toggleDownloadsPanel()">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z" />
                    </svg>
                    Downloads
                </div>
                <div class="menu-separator"></div>
                <div class="menu-item" onclick="openSettings()">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z" />
                    </svg>
                    Settings
                </div>
            `;
            
            // Position the menu
            const button = event.currentTarget;
            const rect = button.getBoundingClientRect();
            menu.style.position = 'absolute';
            menu.style.top = `${rect.bottom + 5}px`;
            menu.style.right = '10px';
            
            // Remove existing menu if any
            const existingMenu = document.querySelector('.menu-dropdown');
            if (existingMenu) existingMenu.remove();
            
            document.body.appendChild(menu);
            
            // Close menu when clicking outside
            const closeMenu = (e) => {
                if (!menu.contains(e.target) && e.target !== button) {
                    menu.remove();
                    document.removeEventListener('click', closeMenu);
                }
            };
            
            setTimeout(() => {
                document.addEventListener('click', closeMenu);
            }, 0);
        }

        function updateSiteIcon(url) {
            const siteIcon = document.getElementById('site-icon');
            if (url.startsWith('ssnnd0://')) {
                siteIcon.src = 'icons/internal-icon.png'; // Add your internal page icon
            } else {
                siteIcon.src = `https://www.google.com/s2/favicons?domain=${encodeURIComponent(url)}`;
            }
        }

        // Add keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey) {
                switch (e.key) {
                    case 't':
                        e.preventDefault();
                        createTab();
                        break;
                    case 'w':
                        e.preventDefault();
                        closeTab(activeTabId);
                        break;
                    case 'r':
                        e.preventDefault();
                        refreshPage();
                        break;
                }
            }
        });

        // Add tab resizing functionality
        function updateTabWidths() {
            const tabs = document.querySelectorAll('.tab');
            const tabBar = document.getElementById('tab-bar');
            const availableWidth = tabBar.offsetWidth - 40; // Account for new tab button
            const minTabWidth = 100;
            const maxTabWidth = 240;
            
            let tabWidth = Math.floor(availableWidth / tabs.length);
            tabWidth = Math.max(minTabWidth, Math.min(maxTabWidth, tabWidth));
            
            tabs.forEach(tab => {
                tab.style.width = `${tabWidth}px`;
            });
        }

        // Update tab widths when tabs change or window resizes
        window.addEventListener('resize', updateTabWidths);
        new ResizeObserver(updateTabWidths).observe(document.getElementById('tab-bar'));
   </script>
</body>
</html>
